@using B03.EE.BlanckeK.Lib.Models
@{
    int questionCounter = 0;
    string questionString = "input" + questionCounter;
}

@model Quiz

<div class="card">
    <div class="card-header text-center">@Model.QuizName</div>
    <br/>
    <div class="card-body" style="margin-bottom: 0%">
        <div class="card">
            @foreach (var question in Model.Questions)
            {
                <div id="login_for_review" class="modal hide"  role="dialog">

                </div>
                <div class="card">
                    <fieldset id="@questionCounter" name="question">
                        <legend class="card-header" style="background-color: lightblue; color: black; margin-bottom: 1%">@question.QuestionText<span id="@questionCounter span" class="float-right"></span></legend>
                        @foreach (var answer in question.AnswerList)
                        {
                            <label class="input-group">
                                <input style="margin-right: 1%" type="checkbox" name="@questionString" value="@answer.IsCorrectAnswer">@answer.AnswerText
                            </label>
                        }
                    </fieldset>
                </div>
                questionCounter++;
                questionString = "input" + questionCounter;
            }
            <button class="btn-success" type="button" onclick="validate()" id="answer" value="submit">Submit</button>
        </div>
    </div>
    <div class="card-footer"><a asp-controller="Quiz" asp-action="Index" class="btn btn-primary">Back to list</a></div>
</div>

<div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <p id="scoreBoard"></p>
    </div>
 </div>





<script>
    
    function popup(score, maxScore)
    {
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        var modal = document.getElementById('myModal');
        var scoreboard = document.getElementById("scoreBoard");
        scoreboard.innerHTML = "Your score is " + score + "/" + maxScore;

        // When the user clicks on <span> (x), close the modal
        span.onclick = function ()
        {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event)
        {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        modal.style.display = "block";
    }

    function validate() {
        document.getElementById("answer").onclick = validate;
        var maxScore = document.getElementsByName("question").length;
        var score = 0;

        for (var i = 0; i < maxScore; i++)
        {
            var isCorrect = false;
            var questionElement = "input" + i;
            var checkboxes = document.getElementsByName(questionElement);
            var currentQuestionSpan = document.getElementById(i + " span");

            for (var counter = 0; counter < checkboxes.length; counter++) {
                if (checkboxes[counter].value === "on" && checkboxes[counter].checked === true) {
                    isCorrect = false;
                    break;
                }
                if (checkboxes[counter].checked && (checkboxes[counter].value === "value")) {
                    isCorrect = true;
                }
            }
            if (isCorrect) {
                score++;
                currentQuestionSpan.innerHTML = "Correct";
                currentQuestionSpan.style.color = '#3c7d3e';
            } else {
                document.getElementById(i + " span").innerHTML = "Wrong";
                currentQuestionSpan.style.color = '#ff0000';
            }
            popup(score, maxScore);
        }
    }
</script>
